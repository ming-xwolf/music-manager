# 🎵 音频文件管理器

一个现代化的桌面应用程序，帮助您自动整理和重命名音频文件，为文件添加序号前缀，让您的音乐库更加井然有序。

## 📖 文档导航
- [使用示例](USAGE_EXAMPLE.md) - 详细的操作示例和使用技巧
- [项目结构](PROJECT_STRUCTURE.md) - 项目架构和文件组织
- [开发指南](DEVELOPMENT_GUIDE.md) - 开发环境配置和贡献指南
- [GenAI功能详细文档](README_GENAI.md) 🤖 - AI智能分析功能完整指南

## ✨ 功能特点

- 🎵 **多格式支持**: 支持MP3、WAV、FLAC、AAC、OGG、M4A、WMA、OPUS、AIFF、AU、RA、MP2等12种音频格式
- 📁 **智能文件夹选择**: 支持浏览选择文件夹，直观的路径输入
- 🔍 **智能分析**: 自动分析文件命名状态，检测编号连续性和重复性
- 🤖 **AI智能文件名分析**: 集成大语言模型，自动识别歌手、语言和歌曲名称
- 🎯 **多种排序方式**: 支持文件名、文件大小、LLM建议等多种排序方式
- ✅ **批量重命名**: 自动为音频文件添加连续的序号前缀（格式：01-文件名.扩展名）
- 🖥️ **现代化GUI**: 基于CustomTkinter的美观桌面界面
- 📊 **状态卡片**: 实时显示文件统计和处理状态
- ⏱️ **实时进度条**: 分析和重命名过程中显示详细进度信息
- 🔒 **安全操作**: 双阶段重命名机制，避免文件名冲突

## 🚀 快速开始

### 环境要求
- Python 3.7+
- CustomTkinter 5.2.0+

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd music-manager
   ```

2. **创建虚拟环境（推荐）**
   ```bash
   conda create -n music-manager python=3.9
   conda activate music-manager
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **启动应用**
   
   **推荐方式（自动环境管理）：**
   ```bash
   chmod +x start_gui.sh
   ./start_gui.sh
   ```
   
   **手动方式（需要先激活环境）：**
   ```bash
   # 必须先激活虚拟环境
   conda activate music-manager
   
   # 然后启动应用
   python main.py
   ```
   
   ⚠️ **重要提示**：使用IDE工具（如Cursor、VS Code）时，请确保：
   - 已正确配置Python解释器路径
   - 终端会自动激活music-manager环境
   - 参考 `DEVELOPMENT_GUIDE.md` 进行IDE配置

## 🎯 使用说明

### 基本操作流程

1. **选择文件夹**
   - 点击"📁 浏览"按钮选择包含音频文件的文件夹
   - 或者直接在输入框中输入文件夹路径

2. **配置GenAI功能（可选）**
   - 点击"GenAI设置"按钮打开配置窗口
   - 启用GenAI功能并选择LLM提供者：
     - **Ollama（推荐）**: 本地部署，隐私保护，需先安装Ollama
     - **Deepseek**: 云端API，需要API密钥
   - 测试连接确保配置正确
   - 保存配置
   
   📚 **详细配置指南**: 请参阅 [GenAI功能详细文档](README_GENAI.md) 获取完整的安装配置步骤

3. **分析文件**
   - 点击"🔍 分析文件夹"按钮
   - 系统会显示实时进度条，包含以下步骤：
     - 检测音频文件
     - 分析文件状态
     - AI智能分析文件名（如果启用GenAI）
     - 生成重命名建议
   - 在状态卡片中显示统计信息
   - 在文件列表中显示每个文件的详细状态和AI建议

4. **查看分析结果**
   - **音频文件总数**: 检测到的音频文件数量
   - **需要处理的文件**: 需要重命名的文件数量
   - **编号连续性**: 检查现有编号是否连续
   - **编号唯一性**: 检查是否存在重复编号
   - **GenAI状态**: 显示AI功能的可用状态
   - **文件列表**: 显示每个文件的原名、AI建议和最终建议名

5. **重命名文件**
   - 确认分析结果和AI建议无误后
   - 点击"✅ 开始重命名文件"按钮
   - 系统会显示确认对话框
   - 确认后自动执行批量重命名，显示实时进度

### 界面说明

#### 主要区域
- **标题区域**: 应用名称和功能描述
- **文件夹选择区域**: 路径输入和浏览按钮
- **排序选项区域**: 多种排序方式选择（包括LLM建议排序）
- **操作按钮区域**: 分析、重命名和GenAI设置按钮
- **进度条区域**: 实时显示分析和重命名进度
- **GenAI状态区域**: 显示AI功能的当前状态
- **状态卡片区域**: 四个状态指示卡片
- **文件列表区域**: 可滚动的文件详情列表，包含AI建议列

#### 状态指示
- **正常** ✅: 文件已正确命名
- **缺少前缀** 🟡: 文件需要添加序号前缀
- **重复编号** 🔴: 存在重复的序号前缀

#### GenAI状态指示
- 🟢 **GenAI可用**: AI功能正常工作
- 🟡 **GenAI功能已禁用**: 需要在设置中启用
- 🟡 **GenAI未配置**: 需要配置LLM提供者
- 🔴 **服务不可用**: LLM服务无法连接
- 🔴 **GenAI模块不可用**: 缺少必要依赖

#### LLM建议指示
- ✅ **已符合格式**: 文件名已经是标准格式
- 🟢 **高置信度**: AI分析结果可信度高（>0.7）
- 🟡 **中等置信度**: AI分析结果可信度中等（>0.4）
- 🔴 **低置信度**: AI分析结果可信度低（≤0.4）
- ❌ **分析失败**: AI分析出错或服务不可用

### 文件命名规则

#### 基础命名规则
- **原始文件**: `歌曲名称.mp3`
- **重命名后**: `01-歌曲名称.mp3`
- **序号格式**: 两位数字，自动补零（01, 02, 03...）
- **保持原名**: 保留原始文件名和扩展名

#### AI智能命名规则（GenAI功能）
当启用GenAI功能时，系统会按照标准格式分析和重命名文件：
- **标准格式**: `歌手-语言-歌曲名`
- **语言类型**: 国语、粤语、英语
- **示例转换**:
  - 原文件: `青花瓷.mp3` → AI分析后: `01-周杰伦-国语-青花瓷.mp3`
  - 原文件: `Hello.mp3` → AI分析后: `02-Adele-英语-Hello.mp3`
- **智能跳过**: 已符合标准格式的文件会被自动识别并跳过AI分析

## 📁 支持的音频格式

| 格式 | 扩展名 | 说明 |
|------|--------|------|
| MP3 | .mp3 | 最常用的音频格式 |
| WAV | .wav | 无损音频格式 |
| FLAC | .flac | 免费无损音频编解码器 |
| AAC | .aac | 高级音频编码 |
| OGG | .ogg | 开源音频格式 |
| M4A | .m4a | Apple音频格式 |
| WMA | .wma | Windows Media Audio |
| OPUS | .opus | 开放音频编解码器 |
| AIFF | .aiff | 音频交换文件格式 |
| AU | .au | Sun/Java音频格式 |
| RA | .ra | RealAudio格式 |
| MP2 | .mp2 | MPEG-1 Audio Layer II |

## 🛠️ 技术架构

### 桌面应用技术
- **Python 3.9**: 主要开发语言
- **CustomTkinter 5.2.0**: 现代化GUI框架
- **Tkinter**: 底层GUI支持
- **Threading**: 后台任务处理
- **PyPinyin**: 中文拼音排序支持

### GenAI智能分析技术
- **多LLM提供者支持**: 
  - **Ollama**: 本地部署，隐私保护，推荐模型 `qwen2.5:7b`
  - **Deepseek**: 云端API，快速响应，`deepseek-chat` 模型
- **智能文件名分析**: 自动识别歌手、语言类型、歌曲名称
- **标准格式检测**: 正则表达式识别已符合标准的文件名
- **置信度评估**: 对AI分析结果进行可信度评估

### 核心功能模块
- **AudioFileManager类** (core/): 音频文件分析和重命名核心逻辑
- **MusicManagerMainWindow类** (ui/): 主窗口界面和用户交互
- **StatusCards类** (ui/): 状态卡片组件
- **FileList类** (ui/): 文件列表组件
- **SortOptions类** (ui/): 排序选项组件
- **GenAIConfigWindow类** (ui/): GenAI配置窗口
- **ConfigManager类** (genai/): GenAI配置管理
- **FilenameAnalyzer类** (genai/): 文件名智能分析
- **LLM提供者类** (genai/): Ollama和Deepseek提供者
- **格式化工具** (utils/): 数据格式化函数

### 设计原则
- **单一职责原则**: 每个类专注一个功能
- **模块化设计**: 清晰的文件组织结构
- **可维护性**: 易于理解和修改的代码
- **可扩展性**: 支持功能扩展的架构

## 📂 项目结构

```
music-manager/
├── main.py                    # 应用入口文件
├── core/                      # 核心业务逻辑
│   ├── __init__.py
│   └── audio_manager.py       # 音频文件管理器核心类
├── ui/                        # 用户界面
│   ├── __init__.py
│   ├── main_window.py         # 主窗口类
│   ├── components.py          # UI组件类
│   └── genai_config_window.py # GenAI配置窗口
├── genai/                     # GenAI智能分析模块
│   ├── __init__.py
│   ├── base.py               # LLM提供者基类
│   ├── config.py             # 配置管理器
│   ├── deepseek_provider.py  # Deepseek API提供者
│   ├── ollama_provider.py    # Ollama本地提供者
│   └── filename_analyzer.py  # 文件名智能分析器
├── utils/                     # 工具函数
│   ├── __init__.py
│   └── formatters.py          # 格式化工具函数
├── genai_config.json          # GenAI配置文件
├── requirements.txt           # Python依赖
├── start_gui.sh              # 应用启动脚本
├── README.md                 # 项目说明
├── README_GENAI.md           # GenAI功能详细文档
├── PROJECT_STRUCTURE.md      # 项目架构
└── USAGE_EXAMPLE.md          # 使用示例
```

## 🧪 开发测试

### 测试覆盖
- ✅ 音频文件格式识别
- ✅ 数字前缀检测
- ✅ 文件分析功能
- ✅ GUI应用启动
- ✅ 模块化架构设计

## ⭐ 特性亮点

### 🎨 现代化界面设计
- 清爽的卡片式布局
- 直观的状态指示
- 响应式组件设计
- 友好的用户体验

### ⚡ 高效处理
- 后台线程处理，避免界面卡顿
- 智能文件分析算法
- 安全的重命名机制
- 实时状态更新

### 🔒 安全可靠
- 操作前确认对话框
- 双阶段重命名避免冲突
- 错误处理和用户提示
- 详细的操作日志

## ❓ 常见问题

### 基础功能

### Q: 如何启动应用？
A: 运行 `./start_gui.sh` 或 `conda activate music-manager && python main.py` 启动应用。

### Q: 重命名后能否撤销？
A: 目前不支持自动撤销，建议重命名前备份重要文件。

### Q: 是否支持子文件夹？
A: 当前版本只处理指定文件夹中的直接文件，不递归处理子文件夹。

### Q: 如何处理重复的文件名？
A: 系统使用双阶段重命名机制，先生成临时文件名，再重命名为目标文件名，有效避免冲突。

### GenAI功能

### Q: 如何启用GenAI功能？
A: 点击"GenAI设置"按钮，启用功能并配置LLM提供者（推荐使用Ollama）。

### Q: Ollama和Deepseek有什么区别？
A: 
- **Ollama**: 本地部署，免费使用，隐私保护，需要先安装Ollama软件
- **Deepseek**: 云端API，响应快速，需要API密钥，按使用量付费

### Q: 如何安装Ollama？
A: 
1. 访问 [Ollama官网](https://ollama.ai) 下载安装
2. 运行 `ollama pull qwen2.5:7b` 下载推荐模型
3. 运行 `ollama serve` 启动服务

### Q: GenAI分析不准确怎么办？
A: 
- 尝试更换LLM提供者或模型
- 检查文件名是否包含足够的信息
- 手动修改不准确的结果
- 查看置信度指示，低置信度结果建议人工检查

### Q: 为什么有些文件没有AI分析？
A: 系统会自动跳过已符合标准格式（歌手-语言-歌曲名）的文件，避免重复分析。

### Q: GenAI功能是否影响性能？
A: AI分析在后台进行，不会阻塞界面。Ollama本地分析速度较快，Deepseek云端分析需要网络请求。

📚 **更多GenAI问题**: 请参阅 [GenAI功能详细文档](README_GENAI.md) 查看完整的故障排除指南和性能优化建议。

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

1. Fork项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建Pull Request

## 📄 许可证

MIT License

## 📊 更新日志

### v3.0.0 (2024-12-21)
- 🤖 **GenAI智能分析**: 集成大语言模型，自动识别歌手、语言和歌曲名称
- 🔌 **多LLM提供者**: 支持Ollama本地部署和Deepseek云端API
- 🎯 **智能排序**: 新增LLM建议排序方式
- ⏱️ **实时进度条**: 分析和重命名过程显示详细进度
- 🎨 **界面优化**: 新增GenAI配置窗口和状态显示
- 📝 **标准格式**: 支持"歌手-语言-歌曲名"标准命名格式
- 🧠 **智能跳过**: 自动识别已符合标准格式的文件
- 🔍 **置信度评估**: 对AI分析结果进行可信度评估

### v2.0.0 (2024-12-20)
- 🖥️ 全新桌面应用版本
- 🎨 基于CustomTkinter的现代化GUI
- 📊 状态卡片显示
- 🔄 后台线程处理
- ✨ 更好的用户体验

### v1.0.0 (2024-12-20)
- ✨ 首次发布Web版本
- 🎵 支持12种音频格式
- 📁 多种文件夹选择方式
- �� 智能文件分析
- ✅ 安全批量重命名 